<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WebRTC VLM Multi-Object Detection</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background:#0b0e14; color:#e6e6e6; }
    header { padding: 12px 16px; border-bottom: 1px solid #222; display:flex; gap:12px; align-items:center; }
    .tag { padding:4px 8px; border:1px solid #444; border-radius:999px; font-size:12px; }
    main { display:grid; grid-template-columns: 1fr 320px; gap:16px; padding:16px; }
    #stage { position: relative; width:100%; max-width: 920px; aspect-ratio: 16/9; background:#111; border-radius:12px; overflow:hidden; }
    video, canvas { position:absolute; inset:0; width:100%; height:100%; object-fit:contain; }
    #controls { display:flex; flex-direction:column; gap:12px; }
    button, select { background:#1a1f2b; color:#e6e6e6; border:1px solid #333; padding:10px 12px; border-radius:10px; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .small { font-size:12px; color:#aaa; }
    pre { background:#0f1320; padding:8px; border-radius:8px; overflow:auto; max-height:180px; }
    a { color:#8ab4f8; }
    .ok { color:#7bd88f; }
    .warn { color:#f6d365; }
  </style>
</head>
<body>
<header>
  <strong>Real-time WebRTC VLM Multi-Object Detection</strong>
  <span class="tag" id="modeTag">MODE=?</span>
  <span class="tag" id="statusTag">idle</span>
</header>

<main>
  <section>
    <div id="stage">
      <video id="video" playsinline muted></video>
      <canvas id="overlay"></canvas>
    </div>
    <div class="small">
      Laptop URL: <code id="hostUrl"></code>
      &nbsp;|&nbsp; Metrics API: <code id="metricsUrl"></code>
    </div>
  </section>

  <aside id="controls">
    <div class="row">
      <button id="btnStart">Start Camera</button>
      <button id="btnStop">Stop</button>
    </div>
    <div class="row">
      <label>Mode:</label>
      <select id="modeSel">
        <option value="wasm">WASM (on-device)</option>
        <option value="server">Server (WebSocket)</option>
      </select>
    </div>
    <div class="row">
      <label>Input:</label>
      <select id="resSel">
        <option value="320x240">320x240</option>
        <option value="640x480">640x480</option>
        <option value="1280x720">1280x720</option>
      </select>
      <label>Target FPS:</label>
      <select id="fpsSel">
        <option>10</option><option>15</option><option>20</option>
      </select>
    </div>
    <div class="row">
      <button id="btnQR">Show QR</button>
      <canvas id="qr" width="256" height="256" style="display:none;border:1px solid #333;border-radius:8px;"></canvas>
    </div>
    <div>
      <strong>Metrics (rolling):</strong>
      <pre id="metricsBox">{} </pre>
    </div>
    <div class="small">Tip: Open this page on laptop, tap <em>Show QR</em> and scan from your phone.</div>
  </aside>
</main>

<script>
  const MODE = new URLSearchParams(location.search).get('mode')
             || window.MODE
             || (document.cookie.match(/MODE=([^;]+)/)||[])[1]
             || document.querySelector('#modeTag')?.textContent
             || 'wasm';
</script>

<script type="module" src="/src/app.js"></script>
</body>
</html>
